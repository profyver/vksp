<!DOCTYPE html>
<html lang="ru">
   <head>
      <meta charset="utf-8">
      <title>Парсинг</title>

      <link async="" href="app-a264ccce29.css" rel="stylesheet">
      <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,700,500,900&subset=latin,cyrillic' rel='stylesheet' type='text/css'>
      <link rel="apple-touch-icon" sizes="57x57" href="assets\fav\apple-icon-57x57.png">
      <link rel="apple-touch-icon" sizes="60x60" href="assets\fav\apple-icon-60x60.png">
      <link rel="apple-touch-icon" sizes="72x72" href="assets\fav\apple-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="76x76" href="assets\fav\apple-icon-76x76.png">
      <link rel="apple-touch-icon" sizes="114x114" href="assets\fav\apple-icon-114x114.png">
      <link rel="apple-touch-icon" sizes="120x120" href="assets\fav\apple-icon-120x120.png">
      <link rel="apple-touch-icon" sizes="144x144" href="assets\fav\apple-icon-144x144.png">
      <link rel="apple-touch-icon" sizes="152x152" href="assets\fav\apple-icon-152x152.png">
      <link rel="apple-touch-icon" sizes="180x180" href="assets\fav\apple-icon-180x180.png">
      <link rel="icon" type="image/png" sizes="192x192" href="assets\fav\android-icon-192x192.png">
      <link rel="icon" type="image/png" sizes="32x32" href="assets\fav\favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="96x96" href="assets\fav\favicon-96x96.png">
      <link rel="icon" type="image/png" sizes="16x16" href="assets\fav\favicon-16x16.png">
	  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

      <link rel="manifest" href="assets\fav\manifest.json">
      <meta name="msapplication-TileColor" content="#ffffff">
      <meta name="msapplication-TileImage" content="/assets/fav/ms-icon-144x144.png">
      <meta name="theme-color" content="#ffffff">
      <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script> <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script> <![endif]-->
 </head>
   <body>
 	  <script language="javascript">
window.array = [];
window.arr = [];
window.error = 0;
window.success = 0;
window.cap = false;
window.accUser = '';
window.accPost = '';
            function showHide(element_id) {
                //Если элемент с id-шником element_id существует
                if (document.getElementById(element_id)) {
                    //Записываем ссылку на элемент в переменную obj
                    var obj = document.getElementById(element_id);
                    //Если css-свойство display не block, то:
                    if (obj.style.display != "block") {
                        obj.style.display = "block"; //Показываем элемент
                    }
                    else obj.style.display = "none"; //Скрываем элемент
                }
                //Если элемент с id-шником element_id не найден, то выводим сообщение
                else console.log("Элемент с id: " + element_id + " не найден!");
            }
function showNot(title,text,type,type2) {
	document.getElementById('infoust').innerHTML = '<div class="alert alert-dismissable alert-'+ type2 +'" style="visibility: visible; opacity: 1; display: block; transform: translateY(0px);"><i class="fa fa-check"></i>&nbsp; <strong>'+ title +'</strong> '+ text +'<button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button></div>';
}
function setButton() {
	var url = $("input[name='url']").val();
	if(!url) showNot('Внимание!','Загрузите ссылку','info','info');
	url = url.split('wall')[1];
	url = url.split('_');
	accUser = url[0];
	accPost = url[1];
	var token = $("input[name='token']").val();
	if (token) {
		addScript('https://api.vk.com/method/execute?code=' + encodeURIComponent('return API.users.get({})[0].id;') + '&access_token=' + token + '&callback=checkToken&v=5.34');
		} else showNot('Внимание!','Загрузите «ACCESS_TOKEN»','info','info');
	}
function addScript(src) {
    var elem = document.createElement("script");
    elem.src = src;
    console.log(document.head.appendChild(elem));
}

function checkToken(date) {
	if (date.response) checkFriends();
	else showNot('Ошибка!','«ACCESS_TOKEN» НЕ ВАЛИДНЫЙ! Попробуйте загрузить его снова.','error','danger');
}

function getDialogs() {
if (token) {
	addScript('https://api.vk.com/method/execute?code=' + encodeURIComponent('return API.messages.get({"out":1, "count":1}).items@.id;') + '&access_token=' + token + '&callback=checkFriends&v=5.69');
	} else showNot('Внимание!','Загрузите «ACCESS_TOKEN»','info','info');
}
function checkFriends(test) {
	//console.log(test);
	if(!cap) {

		var token = $("input[name='token']").val();
		var stic = $("input[name='stic']").val();
		addScript('https://api.vk.com/method/execute?code=' + encodeURIComponent('return API.wall.createComment({"owner_id":'+ accUser +', "post_id":'+ accPost +', "sticker_id":'+ stic +'});') + '&access_token=' + token + '&callback=checkFri&v=5.69');
		setTimeout(checkFriends, 1000);
	}
}
function checkFri(data) {
	if(data.error) {
		if(data.error.error_code == 14) {
			document.getElementById('sound1').play();

			result.value += `${'CAPTCHA'}\n`;
			cap = true;
			var rucaptcha_token = $("input[name='rucaptcha']").val();

			if(rucaptcha_token == "" || rucaptcha_token == null) {
				var capKey = $("input[name='captext']").val();
				var stic = $("input[name='stic']").val();
				document.getElementById('infoust').innerHTML = '<img src="'+ data.error.captcha_img +'" alt="каптча"><p><div class="col-xs-4"></div><div class="col-xs-4"><input type="text" name="captext"  class="form-control"  placeholder="токен"></div><div class="col-xs-4"></div><br><br><center><button type="button" class="btn btn-danger btn-raised" onclick="sendCapKnop('+ accUser +','+ accPost +','+ stic +','+data.error.captcha_sid+')">Отправить капчу!</button></center><br>';
			} else {
				var capKey = $("input[name='captext']").val();
				var stic = $("input[name='stic']").val();
				var rucaptcha_token = $("input[name='rucaptcha']").val();
				console.log('Отправили: ' + data.error.captcha_sid);
				$.post(
				  "/zakaz1/cap.php",
				  {
					url: data.error.captcha_img,
					sid: data.error.captcha_sid,
					user: accUser,
					post: accPost,
					sticker: stic,
					rucaptcha: rucaptcha_token
				  },
				  onAjaxSuccess
				);
			}

		}
	} else {
		result.value += `${"Отправили стикер: " +data.response.comment_id}\n`;
	}
}

function onAjaxSuccess(data) {
	var myObject = JSON.parse(data);
	sendCap(myObject['user'],myObject['post'],myObject['sticker'],myObject['sid'],myObject['code']);

	console.log(myObject);
}

function sendCap(owner_id,post_id,sticker_id,captcha_sid,code) {
	console.log("Разгадали капчу " + code);
	result.value += `${"Разгадали капчу: " + code}\n`;
	var captcha_key = code;
	var token = $("input[name='token']").val();
	console.log(code);
	addScript('https://api.vk.com/method/execute?code=' + encodeURIComponent('return API.wall.createComment({"owner_id":'+ owner_id +', "post_id":'+ post_id +', "sticker_id":'+ sticker_id +',"captcha_key":"'+ captcha_key +'","captcha_sid":"'+ captcha_sid +'"});') + '&access_token=' + token + '&callback=checkFriends&v=5.69');
	cap = false;
	//result.value += `${data.response}\n`;
}
function sendCapKnop(owner_id,post_id,sticker_id,captcha_sid) {
	console.log(captcha_sid);
	var captcha_key = $("input[name='captext']").val();
	var token = $("input[name='token']").val();
	addScript('https://api.vk.com/method/execute?code=' + encodeURIComponent('return API.wall.createComment({"owner_id":'+ owner_id +', "post_id":'+ post_id +', "sticker_id":'+ sticker_id +',"captcha_key":"'+ captcha_key +'","captcha_sid":"'+ captcha_sid +'"});') + '&access_token=' + token + '&callback=checkFriends&v=5.69');
	cap = false;
	//result.value += `${data.response}\n`;
}
      </script>
      <nav class="navbar navbar-default navbar-fixed-top">
         <div class="container">
            <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Раскрыть навигацию</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/">Парсинг</a> </div>
         </div>
      </nav>
	<input id="access_token" type="text" size="40" value=""style="visibility: hidden;">
      <div class="container">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
         <div class="row row-offcanvas row-offcanvas-right">
            <div class="col-sm-12 col-md-12 col-lg-12 no-padding pre-pr">
               <div class="sp col-sm-12 col-md-12 col-lg-12">
                  <div class="panel panel-default" style="overflow: hidden;">
                     <div class="panel-body body-captcha">
                        <div id="round" class="bg-header"> <span>Панель запуска ракет!</span> </div>
		<div class="panel-body">
			<div class="form-horizontal row-border">

			&nbsp;&nbsp;
							<div class="row">
								<div class="col-xs-4">
								 <label for="age_from" class="col-sm-2 control-label">Токен</label>
								<input type="text" name="token" class="form-control"  placeholder="от = до &">
								</div>
								<div class="col-xs-4">
								 <label for="age_from" class="col-sm-2 control-label">Ссылка</label>
								<input type="text" name="url" value="https://vk.com/club179187359?w=wall-179187359_733" class="form-control" placeholder="https://vk.com/club179187359?w=wall-179187359_733">
								</div>
								<div class="col-xs-2">
								 <label for="age_from" class="col-sm-2 control-label">rucaptcha</label>
								<input type="text" name="rucaptcha" value="" class="form-control" placeholder="fcdgdsf">
								</div>
								<div class="col-xs-2">
								 <label for="age_from" class="col-sm-2 control-label">Стикер</label>
								<input type="text" name="stic" value=66 class="form-control" pattern="[0-9]{12}" placeholder="1">
								</div>
							</div>
							&nbsp;&nbsp;
			<center><div id="infoust"></div></center>
			&nbsp;&nbsp;
			<audio id="sound1" src="yoursound.wav" preload="auto"></audio>
<p>
<center><button type="button" class="btn btn-danger btn-raised" onclick="setButton()">Начать спам!</button></center>
<input id="access_token" type="text" size="40" value=""style="visibility: hidden;">

	<br>	<center><div id="contact-list"></div></center>

		</div>
	</div>
						  <center><textarea rows="15" cols="100" name="result" id="result"></textarea></center>
<div id = "stretchProgress" class="cssload-main" style="visibility: hidden;" >
	<div class="cssload-heart">
		<span class="cssload-heartL"></span>
		<span class="cssload-heartR"></span>
		<span class="cssload-square"></span>
	</div>
	<div class="cssload-shadow"></div>
</div>
                     </div>
                  </div>
               </div>
            </div>

         </div>
      </div>
          </div>
      <style>.footer:before{position:absolute;content:"";width:100%;height:15px;top:-15px;background:#F1F4F9;}</style>
      <footer class="footer">
         <div class="container">
            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
               <p style="color: #868D94;padding-left: 10px;">Спам<br><a id="tooglePush" href="#"></a></p>
            </div>
         </div>
      </footer>
      <script src="build\js\all-8e2e0c407f.js"></script>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">   </body>
</html>
